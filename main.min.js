function either(){for(var t=Array.prototype.slice.call(arguments),e=0,s=null;null===s;e++)"undefined"!=typeof t[e]&&null!==t[e]&&(s=t[e]);return s}function decodeHTMLEntities(t){return t.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">").replace("&quot;",'"')}function getMessagesAsHTML(t,e){var s=new XMLHttpRequest,a=t.url||"https://scratch.mit.edu/messages/"+(t.page?t.page+"/":"")+(t.index?t.index.toString():"0");s.open("GET",a),s.onreadystatechange=function(){s.readyState===s.DONE&&(200===s.status?"function"==typeof e&&e.call(s,void 0,(new DOMParser).parseFromString(s.responseText,"text/html").getElementById("notification-list").children[0].children):e.call(s,{message:"GET request to "+a+" failed with status "+s.status+" "+s.statusText,status:s.status,statusText:s.statusText,call:function(){try{throw this.message}catch(t){(console.error||console.log)(this.message)}}},void 0))},s.send()}function getMessages(t,e){t.limit=t.limit||20,t.offset=t.offset||0,t.commentsOnly?t.page="comments":t.alertsOnly&&(t.page="alerts");var s=[],a=t.offset+t.limit,i=null,r=function(e,n,h){i=0===n?e:0,getMessagesAsHTML({page:t.page,index:n},function(c,l){c&&h(c,void 0);var o=Math.min(t.limit-s.length,l.length);e+=o;for(var u=null,g=null,p=null,S=null,m=0;m<i+o;m++)if(S=l[m],"H3"===S.tagName){var f=S.innerHTML.replace(",","").split(" ");1===f.length?(u=null,g=null,p=null):(u=f[1],g=f[2],p=f[3]),m>=i?o+=1:i+=1}else m>=i&&s.push(new ScratchMessage(S,u,g,p));e<a?r(e,n+1,h):h(void 0)})};r(t.offset,0,function(t){e(t,s)})}function ScratchDate(t,e,s,a,i,r){void 0!==r&&null!==r||(r=!0),this.hasTime=r;var n=new Date;this.month=either(t,ScratchDate.MONTHS[n.getMonth()]),this.date=either(e,n.getDate()),this.year=either(s,n.getFullYear()),this.hours=r?either(a,n.getHours()):void 0,this.minutes=r?either(i,n.getMinutes()):void 0,this.updateString()}function ScratchMessage(t,e,s,a){var i;this.parentElement=t,this.read="read"===t.className;var r=t.getElementsByClassName("icon-xs")[0].className.split(" ");this.icon=null;for(var n=0;null===this.icon;n++)i=r[n],"black"!==i&&"icon-xs"!==i&&(this.icon=i);this.elements=[],this.snippets=[],this.isAlert="notification"===t.getAttribute("data-type");var h=t.childNodes,c=t.getElementsByClassName("time")[0];c=c?c.innerHTML:void 0;for(var n=0;n<h.length;n++)if(i=h[n],"#text"===i.nodeName&&""!==i.data.trim()||"A"===i.tagName)this.elements.push(i);else if((i.className||"").split(" ").indexOf("comment-snippet")>-1){this.elements.push(i);var l=ScratchMessage.getMessageValue(i);this.snippets.push({full:l,content:l.substring(1,l.length-5)})}this.parseMessage(),this.isAlert?this.date=ScratchDate.fromString(c):c?(c=c.split(" ")[0],this.date=new ScratchDate(e,s,a,c.split(":")[0],c.split(":")[1])):this.date=new ScratchDate(e,s,a,null,null,(!1))}ScratchDate.MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],ScratchDate.fromString=function(t){var e=t.split(" "),s=e[e.length-2].substring(1),a="p.m."===e[e.length-1]?12:0;return timeSplit=s.split(":"),new ScratchDate(e[0],e[1],e[2],Number(timeSplit[0])+a,Number(timeSplit[1]))},ScratchDate.prototype.updateString=function(){return this.hasTime&&(this.time=((this.hours-1)%12+1).toString()+":"+this.minutes.toString()+(this.hours>12?" p.m.":" a.m.")),this.string=(this.hasTime?[this.month,this.date,this.year,"@"+this.time]:[this.month,this.date,this.year]).join(" "),this.string},ScratchDate.prototype.toString=function(){return this.string},ScratchMessage.DESC={},ScratchMessage.DESC.COMMENT=0,ScratchMessage.DESC.REPLY=1,ScratchMessage.DESC.STUDIO_ACTIVITY=2,ScratchMessage.DESC.STUDIO_INVITE=3,ScratchMessage.DESC.FOLLOWED=4,ScratchMessage.DESC.FORUM_POST=5,ScratchMessage.DESC.LOVED=6,ScratchMessage.DESC.FAVORITED=7,ScratchMessage.DESC.REMIXED=8,ScratchMessage.DESCS=["commented on","replied to your comment on","There was new activity in","invited you to curate the studio","is now following you","There are new posts in the forum thread:","loved your project","favorited your project","remixed your project"],ScratchMessage.DESC_FINDS=[1,1,0,1,1,0,1,1,1],ScratchMessage.prototype.parseMessage=function(){this.links=[],this.parts=[];for(var t,e,s=0;s<this.elements.length;s++)e=this.elements[s],t=ScratchMessage.getMessageValue(e,t),this.parts.push(t),"A"===e.tagName&&this.links.push({value:t,href:e.href,elem:e});this.messageString=this.parts.join("");for(var a,s=0;s<ScratchMessage.DESC_FINDS.length;s++)this.parts[ScratchMessage.DESC_FINDS[s]]===ScratchMessage.DESCS[s]&&(a=s);this.type=a,this.users=[],0!==a&&1!==a&&3!==a&&4!==a&&6!==a&&7!==a&&8!==a||this.users.push(this.parts[0])},ScratchMessage.prototype.toString=function(){return this.messageString},ScratchMessage.getMessageValue=function(t,e){e=e||"";var s=decodeHTMLEntities((t.data||t.innerHTML).replace(/[\r\n]/g,"").replace(/\s+/g," "));return""!==e&&" "!==e[e.length-1]&&" : "!==s||(s=s.trimLeft()),s};